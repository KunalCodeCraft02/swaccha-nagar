<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/task1.css">
    <title>Document</title>
</head>

<body>
    <main>
        <div id="page1">
            <nav>
                <div class="logon">
                    <img src="/images/logo.png" alt="">
                </div>
                <div class="links">
                    <a href="#">About</a>
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle" id="trackDropdown">
                            Track <i class="ri-arrow-down-s-line"></i>
                        </a>
                        <div class="dropdown-menu" id="trackMenu">
                            <a href="/solotask" class="dropdown-item">Solo</a>
                            <a href="/teamtrack" class="dropdown-item">Team</a>
                        </div>
                    </div>
                    <a href="/mentor">Mentor</a>
                    <a href="/associate">Associate</a>
                </div>
                <div class="btns">

                    <a href="/logout"><button>Logout <i class="ri-arrow-right-fill"></i></button></a>
                </div>
            </nav>
        </div>
        <div id="page2">
            <div class="task-page">

                <!-- Banner Section -->
                <div class="banner">
                    <div class="banner-img">
                        <!-- <img src="/images/WhatsApp Image 2025-11-27 at 10.36.19 PM.jpeg" alt="Task Banner"> -->
                    </div>
                    <h1 class="banner-title">Enrollment & Referral Drive</h1>
                </div>


                <div class="content-area">

                    <!-- Left Content -->
                    <div class="left-panel">

                        <div class="card">
                            <h2 class="card-title">Description</h2>
                            <p>
                                This task leverages the spirit of competition to drive massive participation. Teams must
                                successfully enroll two neighboring societies or lanes to form new teams, expanding the
                                reach of the NNCC. Solo participants must refer three new individual participants to the
                                Solo Track or one new team to the Team Track. This task ensures wide promotion of the
                                challenge across Kolhapur.
                            </p>
                            <!-- <p>
                                Through this task we intend to imbue the competitive spirit that is necessary to grow
                                and develop.
                            </p>
                            <p>
                                Challenge your friends from other colleges to develop Entrepreneurship Cells in their
                                own
                                college. This task shall evaluate your ability to entice others to accept your
                                challenge.
                            </p> -->
                        </div>

                        <div class="card">
                            <h2 class="card-title">Guidelines</h2>
                            <p>
                                Teams should reach out to RWA representatives or local leaders. <br> 
                                The referred team/individual must complete their registration and reference the referrer's ID.
                                <br>
                                Submission Guidelines: Submission via XL Sheet.
                                <br>
                                Final Point Checklist: <br>
                                <i class="ri-arrow-right-circle-line"></i> Valid registration IDs of referred parties. <br>
                                <i class="ri-arrow-right-circle-line"></i> Contact details of referred teams/individuals.
                                 <br>
                                Marking Scheme: <br>
                                <i class="ri-arrow-right-circle-line"></i> Solo: 30 Pts per solo referral (max 90 Pts) OR 100 Pts for one team referral.
                            </p>
                            
                        </div>

                    </div>


                    <!-- Right Sidebar -->
                    <div class="right-panel">

                        <div class="card small">
                            <h2 class="card-title">Task Status</h2>
                            <p><strong>Deadline:</strong> <span class="badge">15 Feb 2026</span></p>
                            <p><strong>MAX Points :</strong> <span class="badge">90</span></p>
                            <p class="submission-row">
                                <strong>Current submission:</strong>
                                <a id="viewSubmissionBtn" class="view-btn disabled" rel="noopener"
                                    target="_blank">View</a>
                            </p>
                            <p id="submissionMeta" class="upload-meta">No submission yet.</p>
                        </div>

                        <div id="flashMessages">
                            <div class="alert success" id="uploadSuccess" hidden></div>
                            <div class="alert error" id="uploadError" hidden></div>
                        </div>

                        <form id="taskUploadForm" enctype="multipart/form-data">
                            <div class="upload-box" id="uploadBox">
                                <input type="file" id="fileInput" name="file" accept="application/pdf">

                                <div class="upload-icon">â¬†</div>
                                <p id="uploadText">Choose a file or drag it here</p>
                                <span>PDF files only (max 10MB)</span>
                            </div>

                            <p id="fileName" class="file-name"></p>

                            <button id="submitBtn" class="submit-btn" type="submit" disabled>Submit Task</button>
                        </form>

                    </div>

                </div>

            </div>

        </div>
    </main>


    <script>
        const TASK_ID = "task1";
        document.addEventListener('DOMContentLoaded', function () {
            const trackDropdown = document.getElementById("trackDropdown");
            const dropdown = document.querySelector(".dropdown");

            if (trackDropdown && dropdown) {
                trackDropdown.addEventListener("click", (e) => {
                    e.preventDefault();
                    dropdown.classList.toggle("active");
                });

                // Close dropdown when clicking outside
                document.addEventListener("click", (e) => {
                    if (!dropdown.contains(e.target)) {
                        dropdown.classList.remove("active");
                    }
                });
            }
        });

        const uploadBox = document.getElementById("uploadBox");
        const fileInput = document.getElementById("fileInput");
        const uploadText = document.getElementById("uploadText");
        const fileName = document.getElementById("fileName");
        const submitBtn = document.getElementById("submitBtn");
        const uploadForm = document.getElementById("taskUploadForm");
        const viewBtn = document.getElementById("viewSubmissionBtn");
        const submissionMeta = document.getElementById("submissionMeta");
        const successAlert = document.getElementById("uploadSuccess");
        const errorAlert = document.getElementById("uploadError");

        const showAlert = (element, message) => {
            if (!element) return;
            if (message) {
                element.textContent = message;
                element.hidden = false;
            } else {
                element.textContent = "";
                element.hidden = true;
            }
        };

        const updateSubmissionUI = (submission) => {
            if (!viewBtn || !submissionMeta) return;
            if (submission) {
                viewBtn.classList.remove("disabled");
                viewBtn.href = submission.filePath;
                viewBtn.target = "_blank";
                submissionMeta.textContent = `Latest upload: ${(submission.originalFileName || submission.fileName || "submission.pdf")} (${new Date(submission.uploadDate).toLocaleString()})`;
            } else {
                viewBtn.classList.add("disabled");
                viewBtn.removeAttribute("href");
                submissionMeta.textContent = "No submission yet.";
            }
        };

        const fetchSubmission = async () => {
            try {
                const response = await fetch(`/get-task-submission?taskId=${TASK_ID}`);
                if (!response.ok) throw new Error("No submission");
                const data = await response.json();
                updateSubmissionUI(data.submission);
            } catch (error) {
                updateSubmissionUI(null);
            }
        };

        const enableSubmit = (file) => {
            uploadText.innerText = "File selected";
            fileName.innerText = "Selected: " + file.name;
            submitBtn.disabled = false;
            submitBtn.classList.add("enabled");
        };

        const resetUploader = () => {
            uploadText.innerText = "Choose a file or drag it here";
            fileName.innerText = "";
            fileInput.value = "";
            submitBtn.classList.remove("enabled");
            submitBtn.disabled = true;
        };

        const handleFile = (file) => {
            if (!file) return;
            if (file.type !== "application/pdf") {
                alert("Only PDF files allowed!");
                return;
            }
            if (file.size > 10 * 1024 * 1024) {
                alert("File must be less than 10MB!");
                return;
            }
            enableSubmit(file);
        };

        fileInput.addEventListener("change", () => {
            const file = fileInput.files[0];
            handleFile(file);
        });

        uploadBox.addEventListener("dragover", (e) => {
            e.preventDefault();
            uploadBox.classList.add("dragover");
        });

        uploadBox.addEventListener("dragleave", () => {
            uploadBox.classList.remove("dragover");
        });

        uploadBox.addEventListener("drop", (e) => {
            e.preventDefault();
            uploadBox.classList.remove("dragover");
            const file = e.dataTransfer.files[0];
            if (file) {
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;
                handleFile(file);
            }
        });

        uploadForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            showAlert(successAlert, "");
            showAlert(errorAlert, "");

            if (!fileInput.files.length) {
                alert("Please upload a PDF first!");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = "Uploading...";

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);
            formData.append("taskId", TASK_ID);

            try {
                const response = await fetch("/upload-task-file", {
                    method: "POST",
                    body: formData
                });
                const data = await response.json();
                if (!response.ok || !data.success) {
                    throw new Error(data.message || "Upload failed");
                }
                showAlert(successAlert, data.message || "File uploaded successfully.");
                updateSubmissionUI(data.file);
                resetUploader();
            } catch (error) {
                showAlert(errorAlert, error.message || "Unable to upload the file.");
            } finally {
                submitBtn.textContent = "Submit Task";
            }
        });

        fetchSubmission();

    </script>
</body>

</html>